<!doctype html>
<html lang="en">
  <head>
    <title>Giorgio Garasto</title>
    <meta name="description" content="Hi! I'm Giorgio, a Software Engineer trying to make the web a better place since 2004.">
    <meta charset="utf-8">
    <style>
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }

      body {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      @media (min-aspect-ratio: 1840 / 3020) {
        body {
          align-items: flex-start;
        }
      }

      #container {
        position: relative;
        width: 100vmin;
        height: calc((100vmin / 1840) * 3020);
      }

      #container > * {
        position: absolute;
      }

      #power-led {
        top: 22.5%;
        left: 13.55%;
        width: 2.5%;
        aspect-ratio: 1;
        background-color: red;
        filter: blur(2px);
        border-radius: 50%;
        pointer-events: none;
      }

      #frame-shadow {
        top: 13.6%;
        left: 24.3%;
        width: 51.2%;
        height: 28.5%;
        box-shadow: inset 0 0 32px #000;
        pointer-events: none;
      }

      button {
        appearance: none;
        border: none;
        outline: none;
        background: transparent;
      }

      #dpad-up, #dpad-down, #dpad-left, #dpad-right {
        width: 10.5%;
        height: 6.5%;
      }

      #dpad-up, #dpad-down {
        left: 15.5%;
      }

      #dpad-left, #dpad-right {
        top: 64%;
      }

      #dpad-up {
        top: 58%;
      }

      #dpad-down {
        top: 70.5%;
      }

      #dpad-left {
        left: 5.5%;
      }

      #dpad-right {
        left: 25.5%;
      }

      #btn-a, #btn-b {
        width: 15%;
        aspect-ratio: 1;
      }

      #btn-a {
        top: 59.8%;
        left: 78%;
      }

      #btn-b {
        top: 64.2%;
        left: 62%;
      }

      #btn-select, #btn-start {
        top: 78%;
        width: 16.5%;
        height: 10%;
      }

      #btn-start {
        left: 45.5%;
      }

      #btn-select {
        left: 29%;
      }

      img {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }

      canvas {
        top: 13.6%;
        left: 24.3%;
        width: 51.2%;
        height: 28.5%;
        image-rendering: pixelated;
        image-rendering: crisp-edges;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <img src="./frame.jpg" alt="">
      <canvas width="160" height="144"></canvas>
      <div id="power-led"></div>
      <div id="frame-shadow"></div>
      <button id="dpad-up" aria-label="D-pad up"></button>
      <button id="dpad-right" aria-label="D-pad right"></button>
      <button id="dpad-down" aria-label="D-pad down"></button>
      <button id="dpad-left" aria-label="D-pad left"></button>
      <button id="btn-a" aria-label="A"></button>
      <button id="btn-b" aria-label="B"></button>
      <button id="btn-start" aria-label="Start"></button>
      <button id="btn-select" aria-label="Select"></button>
    </div>
    <script type="module">
      import { WasmBoy } from 'https://unpkg.com/wasmboy@0.7.1/dist/wasmboy.wasm.esm.js?module';
      const canvas = document.querySelector('canvas');
      const colorsMap = [
        [0, 63, 0],
        [46, 115, 32],
        [140, 191, 10],
        [160, 207, 10],
      ];
      await WasmBoy.config({
        audioBatchProcessing: true,
        timersBatchProcessing: true,
        audioAccumulateSamples: true,
        graphicsBatchProcessing: true,
        graphicsDisableScanlineRendering: true,
        tileRendering: true,
        tileCaching: true,
        updateGraphicsCallback: (imageDataArray) => {
          for (let i = 0; i < imageDataArray.length; i += 4) {
            const avg = (imageDataArray[i] + imageDataArray[i + 1] + imageDataArray[i + 2]) / 3;
            const colorIndex = Math.floor(avg / 64);
            const [r, g, b] = colorsMap[colorIndex];
            imageDataArray[i] = r;
            imageDataArray[i + 1] = g;
            imageDataArray[i + 2] = b;
          }
        }
      }, canvas);
      [
        ['dpad-up', 'DPAD_UP'],
        ['dpad-right', 'DPAD_RIGHT'],
        ['dpad-down', 'DPAD_DOWN'],
        ['dpad-left', 'DPAD_LEFT'],
        ['btn-a', 'A'],
        ['btn-b', 'B'],
        ['btn-start', 'START'],
        ['btn-select', 'SELECT'],
      ].forEach(([element, button]) =>
        WasmBoy.ResponsiveGamepad.TouchInput.addButtonInput(
          document.querySelector(`#${element}`),
          WasmBoy.ResponsiveGamepad.RESPONSIVE_GAMEPAD_INPUTS[button],
        ),
      );
      await WasmBoy.loadROM('./portfolio.gb');
      await WasmBoy.play();
    </script>
  </body>
</html>
